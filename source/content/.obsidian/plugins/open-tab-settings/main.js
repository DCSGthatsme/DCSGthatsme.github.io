/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var w=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var P=(p,i)=>{for(var t in i)w(p,t,{get:i[t],enumerable:!0})},v=(p,i,t,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let a of N(i))!O.call(p,a)&&a!==t&&w(p,a,{get:()=>i[a],enumerable:!(n=S(i,a))||n.enumerable});return p};var I=p=>v(w({},"__esModule",{value:!0}),p);var W={};P(W,{default:()=>T});module.exports=I(W);var c=require("obsidian");function b(p,i){let t=Object.keys(i).map(n=>E(p,n,i[n]));return t.length===1?t[0]:function(){t.forEach(n=>n())}}function E(p,i,t){let n=p[i],a=p.hasOwnProperty(i),e=a?n:function(){return Object.getPrototypeOf(p)[i].apply(this,arguments)},s=t(e);return n&&Object.setPrototypeOf(s,n),Object.setPrototypeOf(o,s),p[i]=o,r;function o(...l){return s===e&&p[i]===o&&r(),s.apply(this,l)}function r(){p[i]===o&&(a?p[i]=e:delete p[i]),s!==e&&(s=e,Object.setPrototypeOf(o,n||Function))}}var u=require("obsidian"),C={"after-active":"After active tab","after-pinned":"After pinned tabs",end:"At end"},m={openInNewTab:!0,deduplicateTabs:!0,openInSameTabOnModClick:!1,newTabPlacement:"after-active",openNewTabsInOtherTabGroup:!1},f=class extends u.PluginSettingTab{constructor(i,t){super(i,t),this.plugin=t}display(){this.containerEl.empty();let i=()=>{t.settingEl.setCssStyles({opacity:this.plugin.settings.openInNewTab?"":"50%"}),t.setDisabled(!this.plugin.settings.openInNewTab)};new u.Setting(this.containerEl).setName("Always open in new tab").setDesc("Open files in a new tab by default.").addToggle(n=>n.setValue(this.plugin.settings.openInNewTab).onChange(async a=>{await this.plugin.updateSettings({openInNewTab:a}),i()})),new u.Setting(this.containerEl).setName("Prevent duplicate tabs").setDesc("If a tab is already open, switch to it instead of re-opening it.").addToggle(n=>n.setValue(this.plugin.settings.deduplicateTabs).onChange(async a=>{await this.plugin.updateSettings({deduplicateTabs:a})}));let t=new u.Setting(this.containerEl).setName("Open in same tab on ctrl/middle click").setDesc('When "Always open in new tab" is enabled, open in same tab when using Ctrl click or middle click.').addToggle(n=>n.setValue(this.plugin.settings.openInSameTabOnModClick).onChange(async a=>{await this.plugin.updateSettings({openInSameTabOnModClick:a})}));new u.Setting(this.containerEl).setName("Focus explicit new tabs").setDesc("Immediately switch to new tabs opened via middle or ctrl click instead of opening them in the background. New tabs created by regular click will always focus regardless.").addToggle(n=>n.setValue(this.app.vault.getConfig("focusNewTab")).onChange(async a=>{this.app.vault.setConfig("focusNewTab",a)})),new u.Setting(this.containerEl).setName("New tab placement").setDesc("Where to place new tabs.").addDropdown(n=>n.addOptions(C).setValue(this.plugin.settings.newTabPlacement).onChange(async a=>{await this.plugin.updateSettings({newTabPlacement:a})})),new u.Setting(this.containerEl).setName("Prefer opening new tabs in other tab group").setDesc("When the workspace is split, open links in the opposite panel.").addToggle(n=>n.setValue(this.plugin.settings.openNewTabsInOtherTabGroup).onChange(async a=>{await this.plugin.updateSettings({openNewTabsInOtherTabGroup:a})})),i()}};function y(p){return["empty","home-tab-view"].includes(p.view.getViewType())}var L={md:["excalidraw","kanban"]},T=class extends c.Plugin{constructor(){super(...arguments);this.settings={...m}}async onload(){await this.loadSettings(),this.addSettingTab(new f(this.app,this)),this.registerMonkeyPatches(),this.registerEvent(this.app.workspace.on("file-menu",(n,a,e,s)=>{a instanceof c.TFile&&n.addItem(o=>{o.setSection("open"),o.setIcon("file-minus"),o.setTitle("Open in same tab"),o.onClick(async()=>{await this.app.workspace.getLeaf("same").openFile(a)})})}));let t=[["openInNewTab","always open in new tab"],["deduplicateTabs","prevent duplicate tabs"]];for(let[n,a]of t){let e=n.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`);this.addCommand({id:`toggle-${e}`,name:`Toggle ${a}`,callback:async()=>{await this.updateSettings({[n]:!this.settings[n]})}}),this.addCommand({id:`enable-${e}`,name:`Enable ${a}`,callback:async()=>{await this.updateSettings({[n]:!0})}}),this.addCommand({id:`disable-${e}`,name:`Disable ${a}`,callback:async()=>{await this.updateSettings({[n]:!1})}})}}async registerMonkeyPatches(){let t=this,n=this.app.workspace.getUnpinnedLeaf;this.register(b(c.Workspace.prototype,{getLeaf(a){return function(e,...s){let o=t.settings.openInNewTab&&!e;e==!0?e="tab":t.settings.openInNewTab?e=e||"tab":e=e||"same";let r;return e=="tab"?(r=t.getNewLeaf(),(t.app.vault.getConfig("focusNewTab")||o)&&t.app.workspace.setActiveLeaf(r)):e=="same"?t.settings.openInNewTab&&n?r=n.call(this):r=a.call(this,!1,...s):r=a.call(this,e,...s),r.openTabSettingsLastOpenType=e,r}},getUnpinnedLeaf(a){return function(...e){return t.settings.openInNewTab?t.app.workspace.getLeaf("tab"):a.call(this,...e)}}})),this.register(b(c.WorkspaceLeaf.prototype,{openFile(a){return async function(e,s,...o){var g;let r=y(this),l=r&&(!this.openTabSettingsLastOpenType||!["same","tab"].includes(this.openTabSettingsLastOpenType));if(t.settings.deduplicateTabs&&!l){let d=t.findMatchingLeaves(e);if(!d.includes(this)&&d.length>0){let h=(g=t.app.workspace.getActiveViewOfType(c.View))==null?void 0:g.leaf,k=await a.call(d[0],e,{...s,active:!!(s!=null&&s.active)||h==this},...o);return r&&this.parent.children.length>1&&this.detach(),k}}return a.call(this,e,s,...o)}}})),this.register(b(c.Keymap,{isModEvent(a){return function(...e){let s=a.call(this,...e);return t.settings.openInNewTab&&t.settings.openInSameTabOnModClick&&s=="tab"&&(s="same"),s}}}))}async loadSettings(){var n;let t=(n=await this.loadData())!=null?n:{};this.settings=Object.assign({},m,t),Object.keys(t).length==0&&(this.app.vault.setConfig("focusNewTab",!1),await this.updateSettings({}))}async updateSettings(t){Object.assign(this.settings,t),await this.saveData(this.settings)}findMatchingLeaves(t){let n=[];return this.app.workspace.iterateAllLeaves(a=>{var g,d,h;let e=a.getRoot(),s=e instanceof c.WorkspaceRoot||e instanceof c.WorkspaceFloating,o=((d=(g=a.getViewState())==null?void 0:g.state)==null?void 0:d.file)==t.path,r=a.view.getViewType(),l=this.app.viewRegistry.getTypeByExtension(t.extension)==r||((h=L[t.extension])==null?void 0:h.includes(r));s&&o&&l&&n.push(a)}),n}getAllTabGroups(t){let n=new Set;this.app.workspace.iterateAllLeaves(e=>{e.getRoot()==t&&n.add(e.parent)});let a=e=>Math.max(...e.children.map(s=>{var o;return(o=s.activeTime)!=null?o:0}));return[...n].sort((e,s)=>a(e)-a(s))}getNewLeaf(){let t=this.app.workspace.getMostRecentLeaf();if(!t)throw new Error("No tab group found.");let n=t.parent,a=n.children.indexOf(t);if(y(t))return t;let e,s=0;if(this.settings.openNewTabsInOtherTabGroup&&!c.Platform.isPhone){let l=this.getAllTabGroups(t.getRoot()).filter(g=>g!==n).at(-1);l&&(e=l,s=l.children.length)}if(!e&&this.settings.newTabPlacement=="after-pinned"&&t.pinned){e=n;let l=e.children.findIndex((g,d)=>!g.pinned&&d>a);s=l<0?e.children.length:l}!e&&this.settings.newTabPlacement=="end"&&(e=n,s=n.children.length),e||(e=n,s=a+1);let o,r=e.children[Math.min(s,e.children.length-1)];return y(r)?o=r:(o=new c.WorkspaceLeaf(this.app),e.insertChild(s,o)),o}};

/* nosourcemap */